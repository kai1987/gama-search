// Generated by CoffeeScript 1.8.0

/*
 * search 的测试类
 */

(function() {
  var SearchManager, con, config, debug, model_name_1, model_name_2, mulitItem, options, owner_id_1, owner_id_2, search, should, singleItem, table_name;

  should = require('should');

  debug = require('debug')('gama-search::tests::search_test');

  config = require('./config');

  SearchManager = require('../search');


  /*
  action=push&Version=v2&AccessKeyId=$accessKeyId&Signature=$signature&
      SignatureMethod=HMAC-SHA1&Timestamp=$timestamp&SignatureVersion=1.0&
          SignatureNonce=$signatureNonce&
              items=[{"cmd": "ADD",
                  "fields":{
                      "id":"8dac2812baa0b2",
                          "title":"这里是一个标题",
                              "body":"这里是文档的详细内容"}}]"
   */


  /*
      @accessKeyId = searchOptions.accessKeyId
      @accessKeySecret = searchOptions.accessKeySecret
      @apiURL = searchOptions.apiURL || 'http://opensearch.aliyuncs.com'
      @version = searchOptions.version || 'v2'
      @format = searchOptions.format || 'json'
      @timeout = searchOptions.timeout || 3000
      @dataType = searchOptions.dataType || 'json'
       *@serverURL = urlUtil.resolve @apiURL, path.join(@version, 'api/')
      @serverURL = @apiURL
      @indexName = searchOptions.indexName || 'test'
      @signatureMethod = searchOptions.signatureMethod||'HMAC-SHA1'
      @signatureVersion = searchOptions.SignatureVersion || '1.0'
   */

  con = config.opensearch || {};

  options = {
    accessKeyId: con.accessKeyId,
    accessKeySecret: con.accessKeySecret,
    apiURL: con.host
  };

  table_name = 'main';

  owner_id_1 = 'GO2SIsP';

  owner_id_2 = 'CSCC3LtU';

  model_name_1 = 'animations';

  model_name_2 = 'tilemaps';

  search = new SearchManager(options);

  singleItem = [
    {
      id: 'aaaaaaaa',
      title: '这里是一个标题002',
      owner_id: owner_id_1,
      desc: '这里是文档的详细内容',
      model_name: 'iconpack'
    }
  ];

  mulitItem = [
    {
      id: 'bbbbbb',
      title: '这里是一个标题003',
      owner_id: owner_id_1,
      desc: '这里是文档的详细内容',
      model_name: 'iconpack'
    }, {
      id: 'ccccccc',
      title: '这里是一个标题005',
      owner_id: owner_id_1,
      desc: '这里是文档的详细内容',
      model_name: model_name_1
    }, {
      id: 'ddddddd',
      title: '这里是一个标题005',
      owner_id: owner_id_1,
      desc: '这里是文档的详细内容',
      model_name: model_name_2
    }, {
      id: 'eeeeeee',
      title: '这里是一个标题005',
      owner_id: owner_id_2,
      desc: '这里是文档的详细内容',
      model_name: 'iconpack'
    }, {
      id: 'fffffff',
      title: '这里是一个标题005',
      owner_id: owner_id_2,
      desc: '这里是文档的详细内容',
      model_name: model_name_1
    }, {
      id: 'ggggggg',
      title: '这里是一个标题005',
      owner_id: owner_id_2,
      desc: '这里是文档的详细内容',
      model_name: model_name_2
    }
  ];

  describe("search test", function() {
    before(function() {});
    describe("insert tests", function() {
      it('insert single', function(done) {
        return search.insert(singleItem, table_name, function(err, data) {
          console.error("error:" + err);
          console.dir(data);
          return done();
        });
      });
      return it('insert mulit', function(done) {
        return search.insert(mulitItem, table_name, function(err, data) {
          console.error("error:" + err);
          console.dir(data);
          return done();
        });
      });
    });
    describe("update tests", function() {
      it('update single', function(done) {
        return search.update(singleItem, table_name, function(err, data) {
          console.error("error:" + err);
          console.dir(data);
          return done();
        });
      });
      return it('update mulit', function(done) {
        return search.update(mulitItem, table_name, function(err, data) {
          console.error("error:" + err);
          console.dir(data);
          return done();
        });
      });
    });
    return describe('search tests', function() {
      it("search id test", function(done) {
        return search.searchById('9', ['owner_id', owner_id_1, 'OR', 'model_name', model_name_1], function(err, data) {
          console.log("err:" + err);
          console.dir(data);
          return done();
        });
      });
      return it("search default test", function(done) {
        return search.search('文档', ['owner_id', owner_id_1, 'OR', 'model_name', model_name_2], 1, function(err, data) {
          console.error("error:" + err);
          console.dir(data);
          if ((data || {}).status === "OK") {
            console.dir(data.result);
          }
          return done();
        });
      });
    });
  });

}).call(this);
